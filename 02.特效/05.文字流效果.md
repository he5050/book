---
title: 文字流效果
date: 2025-09-26
permalink: /special-effects/text-stream
categories:
  - 特效
tags:
  - react
  - canvas
  - 动画
  - 文字流
---

# 文字流效果

## 效果演示

这是一个使用 React 和 Canvas 实现的动态文字流效果，灵感来源于 p5.js 的实现。文字从屏幕顶部向下流动，形成一种数字雨的效果，同时包含多种语言的文字。

<demo react="react/effects/TextStream/example.tsx" 
:reactFiles="['react/effects/TextStream/index.tsx','react/effects/TextStream/index.scss']" 
/>

## 核心实现

### 1. 组件结构

```tsx
import React, { useEffect, useRef } from 'react';
import './index.scss';

interface Char {
	value: string;
	x: number;
	y: number;
	speed: number;
}

interface Stream {
	chars: Char[];
}

const TextStream: React.FC = () => {
	const canvasRef = useRef<HTMLCanvasElement>(null);
	const streamsRef = useRef<Stream[]>([]);
	const animationFrameIdRef = useRef<number>(0);

	// 定义文案数组
	const copywriting = [
		'梦想的路上，有你相伴，便是最美的风景',
		'你的微笑，是我一天中最温暖的阳光',
		'مرحبا بالعالم',
		'与你相遇，是命运最温柔的安排'
		// ... 更多文案
	];

	// 组件逻辑...

	return (
		<div className="text-stream-container">
			<canvas ref={canvasRef} className="text-stream-canvas" />
		</div>
	);
};

export default TextStream;
```

### 2. 样式文件

```scss
.text-stream-container {
	width: 100%;
	height: 100%;
	overflow: hidden;
	background-color: #000;

	.text-stream-canvas {
		display: block;
		width: 100%;
		height: 100%;
	}
}
```

### 3. 核心逻辑实现

#### 字符和文本流类

```tsx
// 创建字符对象
const createChar = (value: string, x: number, y: number, speed: number): Char => {
	return { value, x, y, speed };
};

// 创建文本流
const createStream = (text: string, x: number): Stream => {
	const y = Math.random() * (text.length * 4);
	const speed = Math.random() * 2 + 1;
	const chars: Char[] = [];

	for (let i = text.length - 1; i >= 0; i--) {
		chars.push(createChar(text[i], x, (y + text.length - i) * charSize, speed));
	}

	return { chars };
};
```

#### 动画循环

```tsx
// 绘制字符
const drawChar = (ctx: CanvasRenderingContext2D, char: Char, isLast: boolean) => {
	const flick = Math.random() * 100;

	if (flick < 10) {
		ctx.fillStyle = 'hsl(120, 30%, 100%)';
		ctx.fillText(Math.floor(Math.random() * 10).toString(), char.x, char.y);
	} else {
		ctx.fillStyle = 'hsl(120, 100%, 100%)';
		ctx.fillText(char.value, char.x, char.y);
	}

	// 更新字符位置
	char.y = char.y > ctx.canvas.height ? 0 : char.y + char.speed;
};

// 动画循环
const animate = (ctx: CanvasRenderingContext2D) => {
	draw(ctx);
	animationFrameIdRef.current = requestAnimationFrame(() => animate(ctx));
};
```

## 使用示例

```tsx
import React from 'react';
import TextStream from './index';
import './index.scss';

const TextStreamExample: React.FC = () => {
	return (
		<div style={{ width: '100%', height: '100vh' }}>
			<TextStream />
		</div>
	);
};

export default TextStreamExample;
```

## 实现细节

1. **Canvas 初始化**：组件使用 useRef 来获取 canvas 元素的引用，并在 useEffect 中初始化 canvas 的大小和上下文。

2. **响应式设计**：通过监听窗口大小变化事件来动态调整 canvas 大小，确保在不同设备上都能正常显示。

3. **动画循环**：使用 requestAnimationFrame 来创建平滑的动画效果，避免使用 setInterval 可能带来的性能问题。

4. **文字流效果**：

   - 每个文字流由多个字符组成，字符从上到下排列
   - 每个字符都有随机的速度，创造出错落有致的下落效果
   - 部分字符会随机闪烁，模拟数字雨的视觉效果
   - 使用半透明背景绘制来创建拖尾效果

5. **多语言支持**：包含多种语言的文字，增加了视觉效果的丰富性。

## 总结

这个文字流效果组件展示了如何使用 React 和 Canvas API 创建复杂的动画效果。通过合理使用 React 的 hooks 和 Canvas API，我们能够实现一个性能良好且视觉效果出色的动态文字流效果。
