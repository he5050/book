---
title: 歌词播放器
date: 2025-09-26
permalink: /special-effects/lyric-player
categories:
  - 特效
---

# 歌词播放器

这是一个基于 React 实现的歌词播放器组件，具有玻璃拟态设计风格和流畅的动画效果。

## 效果演示

<demo react="react/LyricPlayer/example.tsx" 
:reactFiles="['react/LyricPlayer/example.tsx', 'react/LyricPlayer/index.tsx','react/LyricPlayer/lyric-player.scss']" />

## 核心功能

- 玻璃拟态设计风格
- 歌词高亮显示
- 歌词自动滚动
- 点击歌词跳转
- 播放进度同步
- 响应式设计

## 核心代码

### 1. 组件接口定义 (TypeScript)

```typescript
// 歌词行接口
interface LyricLine {
	id: number;
	text: string;
	time?: number; // 时间戳（秒）
}

// 歌词播放器属性
interface LyricPlayerProps {
	title?: string;
	artist?: string;
	lyrics: LyricLine[];
	currentTime?: number;
	onTimeChange?: (time: number) => void;
	isPlaying?: boolean;
	onPlayToggle?: () => void;
}
```

### 2. 主要实现逻辑 (React)

```tsx
const LyricPlayer: React.FC<LyricPlayerProps> = ({
	title = '歌曲标题',
	artist = '艺术家',
	lyrics = [],
	currentTime = 0,
	onTimeChange,
	isPlaying = false,
	onPlayToggle
}) => {
	const [currentActiveIndex, setCurrentActiveIndex] = useState<number>(-1);
	const lyricContainerRef = useRef<HTMLDivElement>(null);
	const lyricLineRefs = useRef<(HTMLDivElement | null)[]>([]);

	// 找到当前应该高亮的歌词行
	useEffect(() => {
		if (lyrics.length === 0) return;

		// 根据时间找到当前行
		let activeIndex = -1;
		for (let i = 0; i < lyrics.length; i++) {
			const lyricTime = lyrics[i].time;
			if (lyricTime !== undefined && lyricTime !== null && lyricTime <= currentTime) {
				activeIndex = i;
			} else {
				break;
			}
		}

		if (activeIndex !== currentActiveIndex) {
			setCurrentActiveIndex(activeIndex);

			// 滚动到高亮行
			if (activeIndex >= 0 && lyricLineRefs.current[activeIndex] && lyricContainerRef.current) {
				const container = lyricContainerRef.current;
				const line = lyricLineRefs.current[activeIndex];
				if (line) {
					line.scrollIntoView({
						behavior: 'smooth',
						block: 'center'
					});
				}
			}
		}
	}, [currentTime, lyrics, currentActiveIndex]);

	// 处理歌词行点击
	const handleLyricClick = (index: number) => {
		const lyricTime = lyrics[index].time;
		if (lyricTime !== undefined && lyricTime !== null && onTimeChange) {
			onTimeChange(lyricTime);
		}
	};

	// 计算进度条宽度
	const getProgressWidth = () => {
		if (lyrics.length === 0) return 0;
		const lastLyric = lyrics[lyrics.length - 1];
		const lastLyricTime = lastLyric.time;
		if (lastLyricTime === undefined || lastLyricTime === null) return 0;
		return Math.min((currentTime / lastLyricTime) * 100, 100); // 限制最大值为100%
	};

	return (
		<div className="lyric-player">
			{/* 头部信息 */}
			<div className="lyric-header">
				<div className="song-info">
					<h1 className="song-title">{title}</h1>
					<p className="song-artist">{artist}</p>
				</div>

				{/* 进度条 */}
				<div className="progress-container">
					<div className="progress-bar">
						<div className="progress" style={{ width: `${getProgressWidth()}%` }} />
					</div>
				</div>
			</div>

			{/* 歌词容器 */}
			<div className="lyric-container" ref={lyricContainerRef}>
				<div className="lyric-content">
					{lyrics.map((line, index) => (
						<div
							key={line.id}
							ref={setLyricLineRef(index)}
							className={`lyric-line ${index === currentActiveIndex ? 'active' : ''}`}
							onClick={() => handleLyricClick(index)}
						>
							{line.text}
						</div>
					))}
				</div>
			</div>

			{/* 控制器 */}
			<div className="lyric-footer">
				<div className="controls">
					<button className="control-btn" onClick={handlePrev}>
						⏮
					</button>
					<button className="control-btn play-btn" onClick={handlePlayToggle}>
						{isPlaying ? '⏸' : '▶'}
					</button>
					<button className="control-btn" onClick={handleNext}>
						⏭
					</button>
				</div>
			</div>
		</div>
	);
};
```

### 3. 样式实现 (SCSS)

```scss
.lyric-player {
	position: relative;
	width: 90%;
	max-width: 700px;
	height: 80vh;
	display: flex;
	flex-direction: column;
	background: rgba(15, 23, 42, 0.7);
	backdrop-filter: blur(10px);
	border-radius: 20px;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
	border: 1px solid rgba(255, 255, 255, 0.1);
	font-family: 'Noto Sans SC', sans-serif;
	color: #ffffff;
	overflow: hidden;

	.lyric-header {
		text-align: center;
		padding: 1rem 0 1rem;
		position: relative;
		background: rgba(15, 23, 42, 0.9);
		backdrop-filter: blur(10px);
		z-index: 10;
		border-bottom: 1px solid rgba(255, 255, 255, 0.1);

		.song-info {
			margin-bottom: 1rem;

			.song-title {
				font-size: 2.5rem;
				font-weight: 700;
				margin-bottom: 0.5rem;
				color: #ffffff;
				text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);

				@media (max-width: 768px) {
					font-size: 2rem;
				}
			}

			.song-artist {
				font-size: 1.2rem;
				color: #cbd5e1;
				margin-bottom: 1rem;

				@media (max-width: 768px) {
					font-size: 1rem;
				}
			}
		}

		.progress-container {
			width: 80%;
			height: 4px;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 2px;
			margin: 0 auto;
			overflow: hidden;

			.progress-bar {
				height: 100%;
				width: 100%;
				background: rgba(255, 255, 255, 0.2);
				border-radius: 2px;
				overflow: hidden;

				.progress {
					height: 100%;
					width: 30%;
					background: linear-gradient(90deg, #3b82f6, #8b5cf6);
					border-radius: 2px;
					transition: width 0.3s ease;
				}
			}
		}
	}

	.lyric-container {
		flex: 1;
		overflow-y: scroll;
		scrollbar-width: none;
		-ms-overflow-style: none;
		padding: 1rem;

		&::-webkit-scrollbar {
			display: none;
		}

		.lyric-content {
			padding: 1rem 0;

			.lyric-line {
				text-align: center;
				font-size: 1.2rem;
				line-height: 3rem;
				transition: all 0.3s ease-out;
				will-change: opacity, transform;
				padding: 0.5rem 1rem;
				white-space: nowrap;
				opacity: 0.4;
				transform: scale(0.9);
				font-weight: 400;
				text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
				cursor: pointer;

				&.active {
					opacity: 1;
					transform: scale(1.05);
					font-weight: 700;
					color: #ffffff;
					background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
					border-left: 3px solid #3b82f6;
					border-right: 3px solid #3b82f6;
				}

				@media (max-width: 768px) {
					font-size: 1rem;
					line-height: 2.8rem;
				}
			}
		}
	}

	.lyric-footer {
		text-align: center;
		padding: 1rem 0 2rem;
		position: relative;
		background: rgba(15, 23, 42, 0.9);
		backdrop-filter: blur(10px);
		z-index: 10;
		border-top: 1px solid rgba(255, 255, 255, 0.1);

		.controls {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 2rem;
			margin-top: 1rem;

			.control-btn {
				background: rgba(255, 255, 255, 0.1);
				border: none;
				border-radius: 50%;
				width: 50px;
				height: 50px;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				transition: all 0.3s ease;
				color: white;
				font-size: 1.2rem;

				&:hover {
					background: rgba(255, 255, 255, 0.2);
					transform: scale(1.1);
				}

				&.play-btn {
					background: linear-gradient(135deg, #3b82f6, #8b5cf6);
					width: 60px;
					height: 60px;

					&:hover {
						background: linear-gradient(135deg, #2563eb, #7c3aed);
					}
				}
			}
		}
	}
}
```

### 4. 使用示例 (React)

```tsx
import React, { useState, useEffect } from 'react';
import LyricPlayer from './index';

// 示例歌词数据
const sampleLyrics = [
	{ id: 1, text: '如今我眼中的世界色彩斑斓', time: 0 },
	{ id: 2, text: '天空呈现出从未见过的色调', time: 5 },
	{ id: 3, text: '城市灯火被染成金黄与绯红', time: 10 },
	{ id: 4, text: '每条街道都像是不同的家园', time: 15 },
	{ id: 5, text: '噢，这种感觉如同一曲交响乐', time: 20 },
	{ id: 6, text: '光与声的和谐旋律', time: 25 },
	{ id: 7, text: '我漂浮在寂静梦想的云端', time: 30 },
	{ id: 8, text: '方圆数里空无一人', time: 35 },
	{ id: 9, text: '这是新的一天，新的开始', time: 40 },
	{ id: 10, text: '等待画笔的空白画布', time: 45 },
	{ id: 11, text: '我自由奔跑，如同艺术品', time: 50 },
	{ id: 12, text: '在这美丽而混乱的洪流中', time: 55 },
	{ id: 13, text: '让我们找到节奏，稳定的节拍', time: 60 },
	{ id: 14, text: '引导我们穿越错综复杂的道路', time: 65 },
	{ id: 15, text: '让这些时刻变得苦乐参半', time: 70 },
	{ id: 16, text: '成为我们短暂日子里最美好的时光', time: 75 },
	{ id: 17, text: '如今我眼中的世界色彩斑斓', time: 80 },
	{ id: 18, text: '天空呈现出从未见过的色调', time: 85 },
	{ id: 19, text: '城市灯火被染成金黄与绯红', time: 90 },
	{ id: 20, text: '每条街道都像是不同的家园', time: 95 },
	{ id: 21, text: '噢，这种感觉如同一曲交响乐', time: 100 },
	{ id: 22, text: '光与声的和谐旋律', time: 105 },
	{ id: 23, text: '我漂浮在寂静梦想的云端', time: 110 },
	{ id: 24, text: '方圆数里空无一人', time: 115 },
	{ id: 25, text: '这是新的一天，新的开始', time: 120 },
	{ id: 26, text: '等待画笔的空白画布', time: 125 },
	{ id: 27, text: '我自由奔跑，如同艺术品', time: 130 },
	{ id: 28, text: '在这美丽而混乱的洪流中', time: 135 },
	{ id: 29, text: '让我们找到节奏，稳定的节拍', time: 140 },
	{ id: 30, text: '引导我们穿越错综复杂的道路', time: 145 },
	{ id: 31, text: '让这些时刻变得苦乐参半', time: 150 },
	{ id: 32, text: '成为我们短暂日子里最美好的时光', time: 155 }
];

const LyricPlayerDemo: React.FC = () => {
	const [currentTime, setCurrentTime] = useState<number>(0);
	const [isPlaying, setIsPlaying] = useState<boolean>(false);
	const [duration] = useState<number>(160); // 歌曲总时长

	// 模拟播放进度
	useEffect(() => {
		let interval: NodeJS.Timeout | null = null;

		if (isPlaying) {
			interval = setInterval(() => {
				setCurrentTime(prevTime => {
					const newTime = prevTime + 1;
					// 如果播放到末尾，重置到开头
					if (newTime >= duration) {
						return 0;
					}
					return newTime;
				});
			}, 1000);
		}

		return () => {
			if (interval) {
				clearInterval(interval);
			}
		};
	}, [isPlaying, duration]);

	const handleTimeChange = (time: number) => {
		setCurrentTime(time);
	};

	const handlePlayToggle = () => {
		setIsPlaying(!isPlaying);
	};

	return (
		<div
			style={{
				display: 'flex',
				justifyContent: 'center',
				alignItems: 'center',
				minHeight: '100vh',
				background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
				position: 'relative'
			}}
		>
			{/* 背景图片 */}
			<div
				style={{
					position: 'absolute',
					top: 0,
					left: 0,
					width: '100%',
					height: '100%',
					backgroundImage: 'url(https://picsum.photos/id/33/1920/1080)',
					backgroundSize: 'cover',
					backgroundPosition: 'center',
					opacity: 0.3,
					zIndex: -1
				}}
			/>

			<LyricPlayer
				title="色彩世界"
				artist="幻想乐队"
				lyrics={sampleLyrics}
				currentTime={currentTime}
				onTimeChange={handleTimeChange}
				isPlaying={isPlaying}
				onPlayToggle={handlePlayToggle}
			/>
		</div>
	);
};

export default LyricPlayerDemo;
```

## 实现要点

1. **玻璃拟态效果**：使用 `backdrop-filter: blur()` 和半透明背景实现
2. **歌词高亮**：通过比较当前时间和歌词时间戳确定高亮行
3. **自动滚动**：使用 `scrollIntoView` 方法使当前歌词行居中显示
4. **点击跳转**：为每行歌词添加点击事件，调用 `onTimeChange` 回调
5. **进度同步**：根据当前播放时间计算进度条宽度
6. **响应式设计**：使用媒体查询适配不同屏幕尺寸

## 使用方法

1. 安装依赖：

```bash
npm install react react-dom
```

2. 将组件文件复制到项目中
3. 在需要使用的地方导入组件：

```tsx
import LyricPlayer from './LyricPlayer';
```

4. 传入相应的 props 即可使用
