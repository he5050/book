---
title: 3.MarkdownAi
date: 2025-08-05 15:12:00
permalink: /notes/markdown-ai-demo
categories:
  - ç¬”è®°
tags:
  - React
  - TypeScript
  - Markdown
  - ECharts
  - AIå¯¹è¯
---

# MarkdownAI ç»„ä»¶

åŸºäº React çš„ AI å¯¹è¯ Markdown æ¸²æŸ“ç»„ä»¶ï¼Œ**å®Œå…¨åŸºäº base.tsx çš„å®ç°**ï¼Œå¹¶æ‰©å±•äº† ECharts å›¾è¡¨å’Œå¼•ç”¨æ ‡è®°æ”¯æŒã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- âœ… **å®Œå…¨åŸºäº base.tsx**: ä¿æŒä¸åŸæœ‰ä»£ç å—ç»„ä»¶çš„ä¸€è‡´æ€§
- âœ… **ä»£ç é«˜äº®å’Œå¤åˆ¶**: ä½¿ç”¨ Popover æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
- âœ… **ä¸»é¢˜åˆ‡æ¢**: æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢
- âœ… **ECharts å›¾è¡¨æ”¯æŒ**: è‡ªåŠ¨è¯†åˆ«å¹¶æ¸²æŸ“å¤šç§å›¾è¡¨ç±»å‹
- âœ… **å¼•ç”¨æ ‡è®°å¤„ç†**: æ”¯æŒ `[[æ•°å­—,'æè¿°']]` æ ¼å¼çš„å¯ç‚¹å‡»å¼•ç”¨
- âœ… **è¡¨æ ¼æ¸²æŸ“ä¼˜åŒ–**: ç¾åŒ–çš„è¡¨æ ¼æ ·å¼
- âœ… **HTML æ ‡ç­¾æ”¯æŒ**: æ”¯æŒåœ¨ Markdown ä¸­åµŒå…¥ HTML
- âœ… **ç©ºç™½è¡Œå¤„ç†ä¼˜åŒ–**: è§£å†³ HTML æ¸²æŸ“é—´è·è¿‡å¤§é—®é¢˜
- âœ… **é“¾æ¥å¤„ç†**: è‡ªåŠ¨åœ¨æ–°çª—å£æ‰“å¼€å¤–éƒ¨é“¾æ¥
- âœ… **TypeScript æ”¯æŒ**: å®Œæ•´çš„ç±»å‹å®‰å…¨

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **react-markdown** - Markdown æ¸²æŸ“æ ¸å¿ƒ
- **react-syntax-highlighter** - ä»£ç è¯­æ³•é«˜äº®
- **ECharts** - æ•°æ®å¯è§†åŒ–å›¾è¡¨
- **Ant Design** - UI ç»„ä»¶åº“
- **github-markdown-css** - GitHub é£æ ¼æ ·å¼

## ğŸ¯ æ ¸å¿ƒå®ç°

### 1. ä»£ç å—ç»„ä»¶

```typescript
// å®Œå…¨åŸºäº base.tsx çš„å®ç°
function CodeBlock({ code, language = '' }: { code: string; language?: string }) {
	const [isDarkTheme, setIsDarkTheme] = useState(false);
	const [copied, setCopied] = useState(false);

	const handleCopy = () => {
		setCopied(true);
		setTimeout(() => setCopied(false), 2000);
	};

	return (
		<div style={{ position: 'relative', margin: '16px 0' }}>
			{/* ä¸ base.tsx å®Œå…¨ä¸€è‡´çš„æŒ‰é’®æ ·å¼ */}
			<div
				style={{
					position: 'absolute',
					right: 8,
					top: 8,
					zIndex: 1,
					backgroundColor: 'rgba(255, 255, 255, 0.2)', // ä¸ base.tsx ä¸€è‡´
					borderRadius: 4,
					padding: 4
				}}
			>
				<Space>
					<Button
						type="text"
						size="small"
						icon={isDarkTheme ? <BulbFilled /> : <BulbOutlined />}
						onClick={() => setIsDarkTheme(!isDarkTheme)}
					/>
					{/* ä½¿ç”¨ Popover æ˜¾ç¤ºå¤åˆ¶æç¤ºï¼Œä¸ base.tsx ä¸€è‡´ */}
					<Popover open={copied} content="å·²å¤åˆ¶ï¼" trigger={[]}>
						<CopyToClipboard text={code} onCopy={handleCopy}>
							<Button type="text" size="small" icon={<CopyOutlined />} />
						</CopyToClipboard>
					</Popover>
				</Space>
			</div>

			<SyntaxHighlighter
				language={language.toLowerCase()}
				style={isDarkTheme ? materialOceanic : materialLight}
				customStyle={{
					padding: '40px 20px 20px',
					borderRadius: 8,
					fontSize: 14,
					overflowX: 'auto'
				}}
				PreTag="div"
			>
				{code.trim()}
			</SyntaxHighlighter>
		</div>
	);
}
```

### 2. ECharts å›¾è¡¨æ”¯æŒ

```typescript
// è‡ªåŠ¨è¯†åˆ«å›¾è¡¨ç±»å‹çš„ ECharts å®¹å™¨
const EChartsContainer: React.FC<{ id: string; style?: React.CSSProperties }> = ({ id, style }) => {
	const chartRef = useRef<echarts.ECharts | null>(null);

	useEffect(() => {
		const chartContainer = document.getElementById(id);
		if (chartContainer && !chartRef.current) {
			chartRef.current = echarts.init(chartContainer);

			// æ ¹æ®å®¹å™¨ ID è‡ªåŠ¨é€‰æ‹©å›¾è¡¨ç±»å‹
			let option: echarts.EChartsOption = {};

			if (id.includes('line') || id.includes('1')) {
				// æŠ˜çº¿å›¾é…ç½®
				option = {
					/* æŠ˜çº¿å›¾é…ç½® */
				};
			} else if (id.includes('bar') || id.includes('2')) {
				// æŸ±çŠ¶å›¾é…ç½®
				option = {
					/* æŸ±çŠ¶å›¾é…ç½® */
				};
			} else if (id.includes('pie') || id.includes('3')) {
				// é¥¼å›¾é…ç½®
				option = {
					/* é¥¼å›¾é…ç½® */
				};
			}

			chartRef.current.setOption(option);
		}
	}, [id]);

	return <div id={id} style={{ width: '100%', height: '400px', ...style }} />;
};
```

### 3. å¼•ç”¨æ ‡è®°å¤„ç†

```typescript
// å¤„ç† [[æ•°å­—,'æè¿°']] æ ¼å¼çš„å¼•ç”¨æ ‡è®°
const replaceReferences = (str: string): string => {
	const regex = /\[\[(\d+),'(.*?)'\]\]/g;

	return str.replace(regex, (match, num, id) => {
		return `<sup className="text-blue-600 cursor-pointer" data-supid="${id}">[${num}]</sup>`;
	});
};

// ç‚¹å‡»å¼•ç”¨æ ‡è®°çš„å¤„ç†
const handleSupClick = (event: React.MouseEvent<HTMLElement>) => {
	const target = event.target as HTMLElement;
	const supid = target.dataset.supid;
	if (supid) {
		message.info(`ç‚¹å‡»äº†å¼•ç”¨: ${supid}`);
	}
};
```

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

<demo react="react/MarkdownEcharts/playground.tsx" 
:reactFiles="['react/MarkdownEcharts/playground.tsx','react/MarkdownEcharts/MarkdownAI.tsx']" 
/>

### ECharts å›¾è¡¨ç±»å‹

| å®¹å™¨ ID æ ¼å¼                          | å›¾è¡¨ç±»å‹ | ç¤ºä¾‹                       |
| ------------------------------------- | -------- | -------------------------- |
| `echarts-container-line-*` æˆ–åŒ…å« `1` | æŠ˜çº¿å›¾   | `echarts-container-line-1` |
| `echarts-container-bar-*` æˆ–åŒ…å« `2`  | æŸ±çŠ¶å›¾   | `echarts-container-bar-2`  |
| `echarts-container-pie-*` æˆ–åŒ…å« `3`  | é¥¼å›¾     | `echarts-container-pie-3`  |

### å¼•ç”¨æ ‡è®°æ ¼å¼

```markdown
è¿™æ˜¯ä¸€æ®µåŒ…å«å¼•ç”¨çš„æ–‡æœ¬ [[1,'é‡è¦è¯´æ˜']]ã€‚
ç‚¹å‡»æ•°å­— 1 ä¼šæ˜¾ç¤º"é‡è¦è¯´æ˜"çš„æç¤ºä¿¡æ¯ã€‚
```

## ğŸ¨ æ ·å¼å®šåˆ¶

ç»„ä»¶ä½¿ç”¨ `github-markdown-css` ä½œä¸ºåŸºç¡€æ ·å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰ï¼š

```css
.custom-markdown {
	/* è‡ªå®šä¹‰æ ·å¼ */
}

.custom-markdown .markdown-body {
	/* è¦†ç›–é»˜è®¤æ ·å¼ */
	font-size: 16px;
	line-height: 1.8;
}
```

## ğŸ”§ ç©ºç™½è¡Œå¤„ç†

ç»„ä»¶å†…ç½®äº†ç©ºç™½è¡Œå¤„ç†æ’ä»¶ï¼Œè§£å†³ HTML æ¸²æŸ“æ—¶é—´è·è¿‡å¤§çš„é—®é¢˜ï¼š

```typescript
const removeExtraWhitespace = () => {
	return (tree: any) => {
		const removeWhitespace = (node: any) => {
			// ä¿æŒ pre æ ‡ç­¾å†…çš„ç©ºç™½
			if (node.tagName === 'pre') return;

			if (node.type === 'text') {
				// å°†å¤šä¸ªç©ºç™½å­—ç¬¦æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼
				node.value = node.value.replace(/\s+/g, ' ');
			}

			if (node.children) {
				node.children = node.children.filter((child: any) => {
					if (child.type === 'text') {
						return child.value.trim() !== '';
					}
					removeWhitespace(child);
					return true;
				});
			}
		};

		removeWhitespace(tree);
		return tree;
	};
};
```

## ğŸ”„ é¡¹ç›®ç»“æ„ä¼˜åŒ–

### æ–‡ä»¶æ•´åˆ

ä¸ºäº†ç®€åŒ–é¡¹ç›®ç»“æ„ï¼Œæ‰€æœ‰æ¼”ç¤ºåŠŸèƒ½éƒ½æ•´åˆåˆ°äº† `playground.tsx` ä¸­ï¼š

```
MarkdownEcharts/
â”œâ”€â”€ MarkdownAI.tsx      # ä¸»ç»„ä»¶ï¼ˆçº¯å¤–éƒ¨æ•°æ®é©±åŠ¨ï¼‰
â”œâ”€â”€ base.tsx            # åŸºç¡€ä»£ç å—ç»„ä»¶ï¼ˆå‚è€ƒå®ç°ï¼‰
â”œâ”€â”€ echarts.tsx         # ECharts é›†æˆç¤ºä¾‹
â”œâ”€â”€ playground.tsx      # ç»¼åˆæ¼”ç¤ºå¹³å°ï¼ˆåŒ…å«æ‰€æœ‰æ¼”ç¤ºåŠŸèƒ½ï¼‰
â””â”€â”€ README.md           # è¯¦ç»†æ–‡æ¡£
```

### playground.tsx åŠŸèƒ½

- **å®Œæ•´æ¼”ç¤º**: å±•ç¤ºæ‰€æœ‰åŠŸèƒ½ç‰¹æ€§çš„é™æ€æ¼”ç¤º
- **äº¤äº’æµ‹è¯•**: å®æ—¶ç¼–è¾‘å’Œé¢„è§ˆ Markdown å†…å®¹
- **å¤–éƒ¨æ•°æ®**: å¤–éƒ¨æ•°æ®é©±åŠ¨çš„å›¾è¡¨ç¤ºä¾‹
- **æ— æ•°æ®çŠ¶æ€**: å±•ç¤ºæ— æ•°æ®æ—¶çš„å ä½ç¬¦æ•ˆæœ
- **è°ƒè¯•æµ‹è¯•**: å›¾è¡¨æ¸²æŸ“é—®é¢˜çš„è°ƒè¯•å·¥å…·
- **ä½¿ç”¨è¯´æ˜**: è¯¦ç»†çš„ API æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

### é‡è¦å˜æ›´

1. **çº¯å¤–éƒ¨æ•°æ®é©±åŠ¨**: ç§»é™¤äº†æ‰€æœ‰å†…ç½®æ¨¡æ‹Ÿæ•°æ®
2. **ç»Ÿä¸€æ¼”ç¤ºå¹³å°**: æ‰€æœ‰æ¼”ç¤ºåŠŸèƒ½æ•´åˆåˆ°ä¸€ä¸ªæ–‡ä»¶
3. **æ›´æ¸…æ™°çš„ç»“æ„**: å‡å°‘äº†æ–‡ä»¶æ•°é‡ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§

---

*ç°åœ¨åªéœ€è¦è¿è¡Œ `playground.tsx` å°±èƒ½ä½“éªŒ MarkdownAI ç»„ä»¶çš„æ‰€æœ‰åŠŸèƒ½ï¼*