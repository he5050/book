---
title: Svg水波纹效果
date: 2025-09-08 15:00:00
permalink: /notes/svg-water-ripple
description: 使用 SVG 滤镜实现动态水波纹效果
categories:
  - 笔记
  - SVG
tags:
  - JS
  - Svg
  - 滤镜
---

# SVG 水波纹效果

本示例展示了如何使用 SVG 滤镜实现动态水波纹效果，通过 feTurbulence 和 feDisplacementMap 滤镜基元创建流动的波纹效果。增强版支持动态调整水波纹的纹理、颜色、动画速度等多种参数。

## 核心实现原理

水波纹效果的实现基于以下 SVG 滤镜技术：

1. **feTurbulence**：创建湍流噪声

   - baseFrequency：噪声的基础频率，值越小，波纹越大越平缓
   - numOctaves：噪声的倍频数，值越大，细节越多越锐利
   - type：'fractalNoise'（分形噪声）或 'turbulence'（湍流噪声）
   - seed：噪声的随机种子，改变种子值会产生不同的噪声图案
   - stitchTiles：控制是否拼接噪声图案边缘，'stitch' 会减少边缘不连续性

2. **feDisplacementMap**：用噪声图像置换原始图形

   - in：输入源，这里是 SourceGraphic（即我们的圆环）
   - in2：置换图源，这里是上面生成的噪声
   - scale：置换的缩放因子，即波纹的幅度/强度
   - xChannelSelector/yChannelSelector：指定使用噪声的哪个颜色通道进行置换

3. **animate**：为滤镜添加动态效果
   - 通过 animate 元素让 turbulence 的基础频率动起来，模拟流动效果

## 实现效果

<demo react="react/SvgDemo/components/SvgWaterRipple.tsx" 
:reactFiles="['react/SvgDemo/components/SvgWaterRipple.tsx', 'react/SvgDemo/components/SvgWaterRipple.scss']" 
/>

## 动态调整选项

增强版水波纹效果支持以下动态调整选项：

1. **纹理参数**：

   - 波纹幅度 (scale)：控制波纹的强度，值越大波纹越明显
   - 波纹频率 (baseFrequency)：分别控制 X 和 Y 方向的频率
   - 波纹细节 (numOctaves)：控制噪声的细节层次
   - 噪声类型：分形噪声或湍流噪声
   - 噪声种子 (seed)：改变种子值会产生不同的噪声图案
   - 拼接模式 (stitchTiles)：控制是否拼接噪声图案边缘

2. **动画控制**：

   - 动画速度：控制波纹流动的速度
   - 波纹振幅：控制波纹变化的幅度
   - 波纹类型：正弦波、方波、三角波或锯齿波

3. **视觉样式**：
   - 边框宽度：控制进度条的粗细
   - 颜色设置：可自定义激活颜色和背景颜色

## 核心代码解析

### 1. SVG 滤镜定义

```
<filter id="wobble-filter">
<feTurbulence
type="fractalNoise"
baseFrequency="0.05 0.05"
numOctaves="2"
seed="0"
stitchTiles="stitch"
result="turbulenceResult"

>

    <!-- 动画：让 turbulence 的基础频率动起来，模拟流动效果 -->
    <animate
      attributeName="baseFrequency"
      dur="10s"
      values="0.05 0.05;0.08 0.02;0.05 0.05;"
      repeatCount="indefinite"
    />

  </feTurbulence>
  <feDisplacementMap
    in="SourceGraphic"
    in2="turbulenceResult"
    scale="15"
    xChannelSelector="R"
    yChannelSelector="G"
  />
</filter>
```

### 2. 动态参数控制

```
// 更新滤镜参数
const updateFilter = () => {
	if (turbulenceRef.current && displacementMapRef.current && animateRef.current) {
		turbulenceRef.current.setAttribute('baseFrequency', `${frequencyX} ${frequencyY}`);
		turbulenceRef.current.setAttribute('numOctaves', octaves.toString());
		turbulenceRef.current.setAttribute('type', type);
		turbulenceRef.current.setAttribute('seed', seed.toString());
		turbulenceRef.current.setAttribute('stitchTiles', stitchTiles);
		displacementMapRef.current.setAttribute('scale', scale.toString());
		animateRef.current.setAttribute('dur', `${animationSpeed}s`);
	}
};
```

### 3. 样式动态更新

```
// 进度圆环样式动态更新
style={{
  stroke: activeColor,
  strokeWidth: strokeWidth,
  strokeDasharray: `${circumference} ${circumference}`,
  strokeDashoffset: circumference - (progress / 100) * circumference
}}
```

## 技术要点

1. **SVG 滤镜基础**：

   - SVG 滤镜是一系列图像处理操作的组合
   - 每个滤镜基元都会对输入图像进行特定的处理
   - 滤镜可以链式组合，前一个的输出作为后一个的输入

2. **动态效果实现**：

   - 使用 animate 元素为 SVG 属性添加动画
   - 通过 JavaScript 动态修改滤镜参数
   - 结合 CSS 过渡效果实现平滑的进度变化

3. **性能优化**：
   - 使用 CSS 变量管理可变参数
   - 合理设置动画持续时间和重复次数
   - 避免频繁的 DOM 操作

## 应用场景

这种水波纹效果可以应用于：

1. **数据可视化**：进度条、环形图表的美化
2. **UI 组件**：按钮、卡片的悬停效果
3. **动画装饰**：页面背景、装饰元素
4. **游戏开发**：水面效果、魔法效果

## 水波动画效果

除了使用 SVG 滤镜实现的水波纹效果外，我们还可以使用纯 CSS 动画实现另一种水波动画效果。这种效果通过旋转和层叠多个波浪元素来实现。

### 实现效果

<demo react="react/SvgDemo/WaveAnimationExample.jsx" 
:reactFiles="['react/SvgDemo/components/WaveAnimation.tsx', 'react/SvgDemo/components/WaveAnimation.scss']" 
/>

### 动态调整选项

水波动画效果支持以下动态调整选项：

1. **基本参数**：

   - 波浪数量：可调整波浪元素的数量（1-5 个）
   - 卡片尺寸：可调整容器的宽度和高度

2. **视觉样式**：

   - 颜色设置：可自定义三种渐变颜色
   - 透明度：可调整波浪的透明度（0-100%）
   - 弧度：可调整波浪元素的圆角程度（0-50%）

3. **动画控制**：
   - 动画速度：可分别为每个波浪设置不同的旋转速度
   - 每个波浪的动画速度可以独立控制，创造出更丰富的视觉效果

### 核心代码解析

#### 1. 波浪元素生成

```jsx
// 生成波浪元素
const renderWaves = () => {
  return Array.from({ length: waveCount }).map((_, index) => (
    <div
      key={index}
      className="wave"
      style={{
        background: `linear-gradient(744deg, ${colors[0]}, ${colors[1]} 60%, ${colors[2]})`,
        borderRadius: `${borderRadius}%`,
        opacity: opacity / 100,
        width: `${cardWidth * 2.7}px`,
        height: `${cardHeight \* 3.5}px`,
        marginLeft: '-50%',
        marginTop: '-70%',
        animationDuration: `${animationSpeed[index]}s`
}}
/>
));
};

```

#### 2. CSS 动画定义

```scss
@keyframes wave {
	0% {
		transform: rotate(0deg);
	}

	100% {
		transform: rotate(360deg);
	}
}

.wave {
	position: absolute;
	left: 0;
	top: 0;
	border-radius: 40%;
	animation: wave 55s infinite linear;
}
```

#### 3. 参数控制

通过 React 的状态管理，我们可以动态调整所有参数：

```jsx
const [waveCount, setWaveCount] = useState(3);
const [colors, setColors] = useState(['#af40ff', '#5b42f3', '#00ddeb']);
const [animationSpeed, setAnimationSpeed] = useState([55, 50, 45]);
const [borderRadius, setBorderRadius] = useState(40);
const [opacity, setOpacity] = useState(60);
```

## 总结

通过 SVG 滤镜技术，我们可以创建出丰富的视觉效果。增强版水波纹效果展示了：

1. SVG 滤镜的强大功能和灵活性
2. 如何结合动画元素创建动态效果
3. 通过参数控制实现丰富的交互性
4. 将复杂效果封装成可复用的组件

这种技术不仅适用于进度条，还可以扩展到更多创意场景，为网页增添生动的视觉效果。通过动态调整各种参数，你可以创造出无数种不同的水波纹纹理效果。

除了 SVG 滤镜实现的水波纹效果，我们还提供了基于 CSS 动画的水波动画组件，它具有不同的视觉表现和参数控制方式，可以根据具体需求选择使用。
