---
title: èšå…‰ç¯æ•ˆæœ
date: 2025-07-15 22:29:00
permalink: /notes/spotlight
categories:
  - ç¬”è®°
tags:
  - JS
  - èšå…‰ç¯
  - äº¤äº’æ•ˆæœ
---

# èšå…‰ç¯æ•ˆæœå®ç°ä¸ä½¿ç”¨

èšå…‰ç¯æ•ˆæœæ˜¯ä¸€ç§å¼•äººæ³¨ç›®çš„è§†è§‰äº¤äº’æ•ˆæœï¼Œé€šè¿‡æ¨¡æ‹Ÿå…‰ç…§æ•ˆæœæ¥çªå‡ºæ˜¾ç¤ºç‰¹å®šåŒºåŸŸæˆ–è·Ÿéšé¼ æ ‡ç§»åŠ¨ï¼Œå¹¿æ³›åº”ç”¨äºäº§å“å±•ç¤ºã€å›¾ç‰‡æµè§ˆã€æ¸¸æˆç•Œé¢ç­‰åœºæ™¯ã€‚

## æ•ˆæœç‰¹ç‚¹

### è§†è§‰ç‰¹æ€§

- **å…‰ç…§æ¨¡æ‹Ÿ**: æ¨¡æ‹ŸçœŸå®çš„èšå…‰ç¯ç…§å°„æ•ˆæœ
- **åŠ¨æ€è·Ÿéš**: è·Ÿéšé¼ æ ‡æˆ–è§¦æ‘¸ç‚¹ç§»åŠ¨
- **æ¸å˜è¿‡æ¸¡**: å…‰åœˆè¾¹ç¼˜çš„è‡ªç„¶æ¸å˜æ•ˆæœ
- **å¯è°ƒå‚æ•°**: å…‰åœˆå¤§å°ã€äº®åº¦ã€é¢œè‰²å¯è‡ªå®šä¹‰

### äº¤äº’ä½“éªŒ

- **å®æ—¶å“åº”**: æµç•…çš„é¼ æ ‡è·Ÿéšæ•ˆæœ
- **è§†è§‰å¼•å¯¼**: å¼•å¯¼ç”¨æˆ·æ³¨æ„åŠ›åˆ°ç‰¹å®šåŒºåŸŸ
- **æ²‰æµ¸æ„Ÿ**: å¢å¼ºé¡µé¢çš„äº¤äº’æ²‰æµ¸æ„Ÿ
- **å¤šè®¾å¤‡æ”¯æŒ**: æ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸æ“ä½œ

## ğŸ“ å·¥ä½œåŸç†

```mermaid
graph TD
    A[èšå…‰ç¯æ•ˆæœ] --> B[äº‹ä»¶ç›‘å¬]
    A --> C[ä½ç½®è®¡ç®—]
    A --> D[æ ·å¼æ›´æ–°]
    A --> E[åŠ¨ç”»æ§åˆ¶]

    B --> B1[é¼ æ ‡ç§»åŠ¨]
    B --> B2[è§¦æ‘¸äº‹ä»¶]
    B --> B3[çª—å£å˜åŒ–]

    C --> C1[åæ ‡è½¬æ¢]
    C --> C2[è¾¹ç•Œæ£€æµ‹]
    C --> C3[æ¯”ä¾‹è®¡ç®—]

    D --> D1[CSSæ¸å˜]
    D --> D2[Clip-path]
    D --> D3[èƒŒæ™¯å®šä½]

    E --> E1[å¹³æ»‘è¿‡æ¸¡]
    E --> E2[èŠ‚æµä¼˜åŒ–]
    E --> E3[GPUåŠ é€Ÿ]
```

## ğŸ’» å®ç°æ¼”ç¤º

<demo react="react/Spotlight/index.tsx" 
:reactFiles="['react/Spotlight/index.tsx']" 
/>

## ğŸ› ï¸ æ ¸å¿ƒå®ç°åŸç†

### åŸºç¡€ CSS å®ç°

```css
.spotlight-container {
	position: relative;
	overflow: hidden;
	background: #000;
}

.spotlight-overlay {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: radial-gradient(
		circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
		transparent 0%,
		transparent var(--spotlight-size, 100px),
		rgba(0, 0, 0, 0.8) var(--spotlight-fade, 150px),
		rgba(0, 0, 0, 0.95) 100%
	);
	pointer-events: none;
	transition: background 0.1s ease;
}
```

### JavaScript é¼ æ ‡è·Ÿè¸ª

```javascript
class SpotlightEffect {
	constructor(container, options = {}) {
		this.container = container;
		this.options = {
			size: 100,
			fade: 50,
			opacity: 0.8,
			color: 'rgba(0, 0, 0, 0.8)',
			smooth: true,
			...options
		};

		this.overlay = null;
		this.mouseX = 0;
		this.mouseY = 0;
		this.animationId = null;

		this.init();
	}

	init() {
		this.createOverlay();
		this.bindEvents();
	}

	createOverlay() {
		this.overlay = document.createElement('div');
		this.overlay.className = 'spotlight-overlay';
		this.container.appendChild(this.overlay);

		this.updateSpotlight();
	}

	bindEvents() {
		this.container.addEventListener('mousemove', this.handleMouseMove.bind(this));
		this.container.addEventListener('mouseleave', this.handleMouseLeave.bind(this));
		this.container.addEventListener('mouseenter', this.handleMouseEnter.bind(this));
	}

	handleMouseMove(e) {
		const rect = this.container.getBoundingClientRect();
		this.mouseX = ((e.clientX - rect.left) / rect.width) * 100;
		this.mouseY = ((e.clientY - rect.top) / rect.height) * 100;

		if (this.options.smooth) {
			this.smoothUpdate();
		} else {
			this.updateSpotlight();
		}
	}

	smoothUpdate() {
		if (this.animationId) {
			cancelAnimationFrame(this.animationId);
		}

		this.animationId = requestAnimationFrame(() => {
			this.updateSpotlight();
		});
	}

	updateSpotlight() {
		if (!this.overlay) return;

		const { size, fade, color } = this.options;

		this.overlay.style.background = `
      radial-gradient(
        circle at ${this.mouseX}% ${this.mouseY}%,
        transparent 0%,
        transparent ${size}px,
        ${color} ${size + fade}px,
        ${color} 100%
      )
    `;
	}

	handleMouseLeave() {
		if (this.overlay) {
			this.overlay.style.opacity = '0';
		}
	}

	handleMouseEnter() {
		if (this.overlay) {
			this.overlay.style.opacity = '1';
		}
	}

	destroy() {
		if (this.animationId) {
			cancelAnimationFrame(this.animationId);
		}

		if (this.overlay) {
			this.overlay.remove();
		}
	}
}
```

### React Hook å®ç°

```typescript
interface SpotlightOptions {
	size?: number;
	fade?: number;
	opacity?: number;
	color?: string;
	smooth?: boolean;
	enabled?: boolean;
}

const useSpotlight = (options: SpotlightOptions = {}) => {
	const containerRef = useRef<HTMLDivElement>(null);
	const overlayRef = useRef<HTMLDivElement>(null);
	const mousePos = useRef({ x: 50, y: 50 });
	const animationId = useRef<number>();

	const {
		size = 100,
		fade = 50,
		opacity = 0.8,
		color = 'rgba(0, 0, 0, 0.8)',
		smooth = true,
		enabled = true
	} = options;

	const updateSpotlight = useCallback(() => {
		if (!overlayRef.current) return;

		const { x, y } = mousePos.current;
		overlayRef.current.style.background = `
      radial-gradient(
        circle at ${x}% ${y}%,
        transparent 0%,
        transparent ${size}px,
        ${color} ${size + fade}px,
        ${color} 100%
      )
    `;
	}, [size, fade, color]);

	const handleMouseMove = useCallback(
		(e: MouseEvent) => {
			if (!containerRef.current) return;

			const rect = containerRef.current.getBoundingClientRect();
			mousePos.current = {
				x: ((e.clientX - rect.left) / rect.width) * 100,
				y: ((e.clientY - rect.top) / rect.height) * 100
			};

			if (smooth) {
				if (animationId.current) {
					cancelAnimationFrame(animationId.current);
				}
				animationId.current = requestAnimationFrame(updateSpotlight);
			} else {
				updateSpotlight();
			}
		},
		[smooth, updateSpotlight]
	);

	useEffect(() => {
		const container = containerRef.current;
		if (!container || !enabled) return;

		container.addEventListener('mousemove', handleMouseMove);

		return () => {
			container.removeEventListener('mousemove', handleMouseMove);
			if (animationId.current) {
				cancelAnimationFrame(animationId.current);
			}
		};
	}, [handleMouseMove, enabled]);

	return { containerRef, overlayRef };
};
```

## ğŸ¨ é«˜çº§åŠŸèƒ½

### å¤šå…‰æºæ•ˆæœ

```typescript
const MultiSpotlight = () => {
	const [lights, setLights] = useState<Array<{ x: number; y: number; id: string }>>([]);

	const addLight = (e: React.MouseEvent) => {
		const rect = e.currentTarget.getBoundingClientRect();
		const newLight = {
			x: ((e.clientX - rect.left) / rect.width) * 100,
			y: ((e.clientY - rect.top) / rect.height) * 100,
			id: Math.random().toString(36).substr(2, 9)
		};

		setLights(prev => [...prev, newLight]);
	};

	const removeLight = (id: string) => {
		setLights(prev => prev.filter(light => light.id !== id));
	};

	const generateGradient = () => {
		if (lights.length === 0) return 'rgba(0, 0, 0, 0.8)';

		const gradients = lights.map(
			light =>
				`radial-gradient(circle at ${light.x}% ${light.y}%, transparent 0%, transparent 80px, rgba(0, 0, 0, 0.8) 120px)`
		);

		return gradients.join(', ');
	};

	return (
		<div
			className="multi-spotlight"
			onClick={addLight}
			style={{
				background: generateGradient()
			}}
		>
			{lights.map(light => (
				<div
					key={light.id}
					className="light-marker"
					style={{
						left: `${light.x}%`,
						top: `${light.y}%`
					}}
					onClick={e => {
						e.stopPropagation();
						removeLight(light.id);
					}}
				/>
			))}
		</div>
	);
};
```

### å½©è‰²èšå…‰ç¯

```typescript
const ColorfulSpotlight = () => {
	const [currentColor, setCurrentColor] = useState('#ff6b6b');
	const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];

	const getGradient = (x: number, y: number) => `
    radial-gradient(
      circle at ${x}% ${y}%,
      ${currentColor}40 0%,
      ${currentColor}20 50px,
      transparent 100px,
      rgba(0, 0, 0, 0.8) 150px,
      rgba(0, 0, 0, 0.9) 100%
    )
  `;

	return (
		<div className="colorful-spotlight">
			<div className="color-picker">
				{colors.map(color => (
					<button
						key={color}
						className={`color-btn ${currentColor === color ? 'active' : ''}`}
						style={{ backgroundColor: color }}
						onClick={() => setCurrentColor(color)}
					/>
				))}
			</div>
			{/* èšå…‰ç¯å®ç° */}
		</div>
	);
};
```

### åŠ¨ç”»èšå…‰ç¯

```typescript
const AnimatedSpotlight = () => {
	const [isAnimating, setIsAnimating] = useState(false);
	const animationRef = useRef<number>();
	const startTime = useRef<number>();

	const startAnimation = () => {
		setIsAnimating(true);
		startTime.current = Date.now();
		animate();
	};

	const animate = () => {
		const elapsed = Date.now() - (startTime.current || 0);
		const progress = (elapsed % 4000) / 4000; // 4ç§’å¾ªç¯

		// è®¡ç®—åœ†å½¢è·¯å¾„ä¸Šçš„ä½ç½®
		const angle = progress * Math.PI * 2;
		const centerX = 50;
		const centerY = 50;
		const radius = 30;

		const x = centerX + Math.cos(angle) * radius;
		const y = centerY + Math.sin(angle) * radius;

		// æ›´æ–°èšå…‰ç¯ä½ç½®
		updateSpotlightPosition(x, y);

		if (isAnimating) {
			animationRef.current = requestAnimationFrame(animate);
		}
	};

	const stopAnimation = () => {
		setIsAnimating(false);
		if (animationRef.current) {
			cancelAnimationFrame(animationRef.current);
		}
	};

	return (
		<div className="animated-spotlight">
			<button onClick={isAnimating ? stopAnimation : startAnimation}>
				{isAnimating ? 'åœæ­¢åŠ¨ç”»' : 'å¼€å§‹åŠ¨ç”»'}
			</button>
			{/* èšå…‰ç¯å®ç° */}
		</div>
	);
};
```

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

### è§¦æ‘¸äº‹ä»¶æ”¯æŒ

```typescript
const TouchSpotlight = () => {
	const handleTouchMove = (e: React.TouchEvent) => {
		e.preventDefault();
		const touch = e.touches[0];
		const rect = e.currentTarget.getBoundingClientRect();

		const x = ((touch.clientX - rect.left) / rect.width) * 100;
		const y = ((touch.clientY - rect.top) / rect.height) * 100;

		updateSpotlight(x, y);
	};

	const handleTouchStart = (e: React.TouchEvent) => {
		const touch = e.touches[0];
		const rect = e.currentTarget.getBoundingClientRect();

		const x = ((touch.clientX - rect.left) / rect.width) * 100;
		const y = ((touch.clientY - rect.top) / rect.height) * 100;

		updateSpotlight(x, y);
	};

	return (
		<div
			className="touch-spotlight"
			onTouchStart={handleTouchStart}
			onTouchMove={handleTouchMove}
			style={{ touchAction: 'none' }}
		>
			{/* å†…å®¹ */}
		</div>
	);
};
```

### è®¾å¤‡æ£€æµ‹

```typescript
const useDeviceDetection = () => {
	const [isMobile, setIsMobile] = useState(false);

	useEffect(() => {
		const checkDevice = () => {
			setIsMobile(
				/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
					navigator.userAgent
				) || window.innerWidth < 768
			);
		};

		checkDevice();
		window.addEventListener('resize', checkDevice);

		return () => window.removeEventListener('resize', checkDevice);
	}, []);

	return isMobile;
};
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### èŠ‚æµä¼˜åŒ–

```typescript
const useThrottledSpotlight = (delay = 16) => {
	const lastUpdate = useRef(0);

	const throttledUpdate = useCallback(
		(x: number, y: number) => {
			const now = Date.now();
			if (now - lastUpdate.current >= delay) {
				updateSpotlight(x, y);
				lastUpdate.current = now;
			}
		},
		[delay]
	);

	return throttledUpdate;
};
```

### GPU åŠ é€Ÿ

```css
.spotlight-overlay {
	will-change: background;
	transform: translateZ(0); /* å¼ºåˆ¶ GPU åŠ é€Ÿ */
	backface-visibility: hidden;
}
```

### å†…å­˜ç®¡ç†

```typescript
const useSpotlightCleanup = () => {
	const cleanupFunctions = useRef<Array<() => void>>([]);

	const addCleanup = (fn: () => void) => {
		cleanupFunctions.current.push(fn);
	};

	useEffect(() => {
		return () => {
			cleanupFunctions.current.forEach(fn => fn());
			cleanupFunctions.current = [];
		};
	}, []);

	return addCleanup;
};
```

## ğŸ§ª æ•…éšœæ’é™¤

### 1. èšå…‰ç¯æ•ˆæœä¸è·Ÿéšé¼ æ ‡

**é—®é¢˜**: èšå…‰ç¯ä½ç½®ä¸æ­£ç¡®æˆ–ä¸è·Ÿéšé¼ æ ‡ç§»åŠ¨
**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥åæ ‡è®¡ç®—æ˜¯å¦æ­£ç¡®
- ç¡®ä¿å®¹å™¨çš„ position å±æ€§è®¾ç½®æ­£ç¡®
- éªŒè¯äº‹ä»¶ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®ç»‘å®š

### 2. æ€§èƒ½é—®é¢˜

**é—®é¢˜**: é¡µé¢å¡é¡¿æˆ–èšå…‰ç¯æ›´æ–°å»¶è¿Ÿ
**è§£å†³æ–¹æ¡ˆ**:

- ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ›´æ–°
- å®ç°èŠ‚æµæˆ–é˜²æŠ–æœºåˆ¶
- å¯ç”¨ GPU åŠ é€Ÿ

### 3. ç§»åŠ¨ç«¯å…¼å®¹æ€§é—®é¢˜

**é—®é¢˜**: åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ•ˆæœå¼‚å¸¸æˆ–æ— æ³•æ­£å¸¸å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ**:

- æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
- é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- æµ‹è¯•å„ç§ç§»åŠ¨è®¾å¤‡

## ğŸ› ï¸ æŠ€æœ¯è¦ç‚¹

### 1. CSS æ¸å˜æŠ€æœ¯

- ä½¿ç”¨ radial-gradient åˆ›å»ºåœ†å½¢å…‰åœˆæ•ˆæœ
- é€šè¿‡ CSS å˜é‡åŠ¨æ€æ§åˆ¶å…‰åœˆä½ç½®å’Œå¤§å°
- åˆ©ç”¨ clip-path å®ç°æ›´å¤æ‚çš„å½¢çŠ¶

### 2. åæ ‡ç³»ç»Ÿè½¬æ¢

- å°†é¼ æ ‡åæ ‡ä»è§†å£åæ ‡è½¬æ¢ä¸ºç›¸å¯¹å®¹å™¨çš„ç™¾åˆ†æ¯”
- å¤„ç†å®¹å™¨è¾¹ç•Œæƒ…å†µ
- æ”¯æŒå“åº”å¼è®¾è®¡

### 3. åŠ¨ç”»ä¼˜åŒ–

- ä½¿ç”¨ requestAnimationFrame å®ç°å¹³æ»‘åŠ¨ç”»
- é€šè¿‡ CSS transition ä¼˜åŒ–è¿‡æ¸¡æ•ˆæœ
- å¯ç”¨ GPU åŠ é€Ÿæå‡æ€§èƒ½

## åº”ç”¨åœºæ™¯

### 1. äº§å“å±•ç¤º

```typescript
const ProductShowcase = ({ product }) => (
	<div className="product-showcase">
		<SpotlightEffect size={150} fade={80}>
			<img src={product.image} alt={product.name} />
			<div className="product-info">
				<h3>{product.name}</h3>
				<p>{product.description}</p>
			</div>
		</SpotlightEffect>
	</div>
);
```

### 2. å›¾ç‰‡æµè§ˆå™¨

```typescript
const ImageViewer = ({ images }) => {
	const [currentImage, setCurrentImage] = useState(0);

	return (
		<div className="image-viewer">
			<SpotlightEffect size={200} color="rgba(0, 0, 0, 0.7)">
				<img src={images[currentImage]} alt="æŸ¥çœ‹å›¾ç‰‡" />
			</SpotlightEffect>

			<div className="image-controls">
				{images.map((_, index) => (
					<button
						key={index}
						onClick={() => setCurrentImage(index)}
						className={index === currentImage ? 'active' : ''}
					/>
				))}
			</div>
		</div>
	);
};
```

### 3. æ¸¸æˆç•Œé¢

```typescript
const GameMap = ({ playerPosition, visibilityRadius }) => (
	<div className="game-map">
		<SpotlightEffect
			size={visibilityRadius}
			fade={50}
			color="rgba(0, 0, 0, 0.9)"
			position={playerPosition}
		>
			<div className="game-world">{/* æ¸¸æˆä¸–ç•Œå†…å®¹ */}</div>
		</SpotlightEffect>
	</div>
);
```

## æœ€ä½³å®è·µ

### è®¾è®¡åŸåˆ™

1. **é€‚åº¦ä½¿ç”¨**: é¿å…è¿‡åº¦çš„èšå…‰ç¯æ•ˆæœå½±å“å†…å®¹é˜…è¯»
2. **æ€§èƒ½ä¼˜å…ˆ**: ä½¿ç”¨ CSS æ¸å˜è€Œé Canvas ç»˜åˆ¶
3. **å¯è®¿é—®æ€§**: æä¾›ç¦ç”¨åŠ¨ç”»çš„é€‰é¡¹
4. **å“åº”å¼**: åœ¨ä¸åŒè®¾å¤‡ä¸Šè°ƒæ•´æ•ˆæœå¼ºåº¦

### å®æ–½å»ºè®®

1. **æ¸è¿›å¢å¼º**: ä»é™æ€æ•ˆæœå¼€å§‹ï¼Œé€æ­¥æ·»åŠ äº¤äº’
2. **ç”¨æˆ·æ§åˆ¶**: å…è®¸ç”¨æˆ·è°ƒæ•´æˆ–å…³é—­æ•ˆæœ
3. **æ€§èƒ½ç›‘æ§**: ç›‘æ§å¯¹é¡µé¢æ€§èƒ½çš„å½±å“
4. **å…¼å®¹æ€§æµ‹è¯•**: ç¡®ä¿åœ¨ä¸åŒæµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ

---

_èšå…‰ç¯æ•ˆæœæ˜¯å¢å¼ºç”¨æˆ·ä½“éªŒçš„æœ‰æ•ˆæ‰‹æ®µï¼Œåˆç†ä½¿ç”¨å¯ä»¥åˆ›é€ å‡ºä»¤äººå°è±¡æ·±åˆ»çš„äº¤äº’ä½“éªŒã€‚_ ğŸ”¦
