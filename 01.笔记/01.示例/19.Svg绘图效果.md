---
title: Svg绘图效果
date: 2025-09-08 10:00:00
permalink: /notes/svg-draw
description: 使用 SVG 模拟毛笔写字绘画效果
categories:
  - 笔记
  - SVG
tags:
  - JS
  - Svg
  - 绘图
---

# SVG 笔刷绘图效果

如何使用 SVG 和 React 实现一个具有多种笔刷效果的绘图应用，包括毛笔、铅笔、泼墨等效果。

## 核心实现思路

项目的核心为 "SVG 滤镜负责外观，JavaScript 逻辑负责交互"：

1. **渲染核心 (SVG Filters)**：

   - 核心在于 SVG 的 `<filter>` 元素，我们预先在 `<defs>` 区域定义好多种滤镜效果
   - 每种笔刷模式（如毛笔、铅笔）对应一个特定的滤镜，通过组合不同的"滤镜基元"来实现：
     - `feTurbulence`：创建随机的柏林噪声，模拟纸张纹理、笔触干湿变化
     - `feDisplacementMap`：使用噪声纹理去"扭曲"绘制的线条，让线条边缘变得不规则
     - `feGaussianBlur`：对线条进行模糊处理，模拟墨水晕染或铅笔的柔和效果
     - `feColorMatrix`：锐化 Alpha 通道，让模糊的边缘重新变得清晰

2. **交互核心 (JavaScript)**：
   - 监听鼠标/触摸屏的三个核心事件：mousedown (开始)、mousemove (移动)、mouseup (结束)
   - 状态管理使用 isDrawing 布尔值和历史栈来实现撤销/重做功能

## 功能特性

- 多种笔刷效果：毛笔、铅笔、泼墨、钢笔
- 可调节笔刷大小和颜色
- 撤销/重做功能
- 清空画布功能
- 响应式设计，支持移动端触摸操作
- 动态笔触效果（毛笔具有压力感应模拟效果）

### 各种笔刷效果特点

1. **毛笔效果**：

   - 模拟传统毛笔的水墨效果
   - 具有动态笔触宽度变化，模拟真实毛笔书写时的压力感应
   - 边缘不规则，有自然的毛刺感
   - 墨水晕染效果，边缘清晰但内部有柔和过渡

2. **铅笔效果**：

   - 模拟铅笔在纸上的颗粒质感
   - 线条有细微的粗糙感和纹理
   - 笔触相对平直但有自然的颗粒变化

3. **泼墨效果**：

   - 模拟墨汁飞溅的效果
   - 线条严重扭曲，形成随机的墨点飞溅
   - 适合创作抽象艺术作品

4. **钢笔效果**：
   - 平滑的线条效果
   - 使用贝塞尔曲线算法创建流畅的笔触
   - 适合精确的线条绘制

### 画布特性

- **纸张纹理**：画布具有真实的纸张纹理效果，增强绘画体验
- **响应式设计**：适配不同屏幕尺寸，支持移动端触摸操作
- **动态背景**：背景纹理与笔刷效果相得益彰

## 实现效果

<demo react="react/SvgDemo/SvgDraw.tsx" 
:reactFiles="['react/SvgDemo/SvgDraw.tsx', 'react/SvgDemo/SvgDraw.scss']" 
/>

## 核心代码解析

### 1. SVG 滤镜定义

```xml

<!-- 毛笔滤镜 -->
<filter id="calligraphy-filter" x="-50%" y="-50%" width="200%" height="200%">
  <!-- 创建水墨纹理噪点 -->
  <feTurbulence
    type="fractalNoise"
    baseFrequency="0.008"
    numOctaves="5"
    result="noise"
    seed="1"
  />
  <!-- 模拟毛笔的不规则边缘 -->
  <feDisplacementMap
    in="SourceGraphic"
    in2="noise"
    scale="20"
    xChannelSelector="R"
    yChannelSelector="G"
  />
  <!-- 模拟墨水晕染 -->
  <feGaussianBlur stdDeviation="2.5" result="blurred" />
  <!-- 创建水墨纹理 -->
  <feTurbulence
    type="turbulence"
    baseFrequency="0.015"
    numOctaves="4"
    result="texture"
    seed="2"
  />
  <!-- 模拟墨水在宣纸上的扩散效果 -->
  <feDisplacementMap
    in="blurred"
    in2="texture"
    scale="10"
    xChannelSelector="R"
    yChannelSelector="G"
  />
  <!-- 锐化边缘，让晕染的墨迹有清晰边界 -->
  <feColorMatrix
    type="matrix"
    values="1 0 0 0 0
            0 1 0 0 0
            0 0 1 0 0
            0 0 0 10 -5"
    result="sharpened"
  />
  <!-- 添加最终的纹理效果 -->
  <feTurbulence
    type="fractalNoise"
    baseFrequency="0.04"
    numOctaves="3"
    result="finalTexture"
    seed="3"
  />
  <feDisplacementMap
    in="sharpened"
    in2="finalTexture"
    scale="6"
    xChannelSelector="R"
    yChannelSelector="G"
  />
</filter>
```

### 2. 绘图逻辑实现

```javascript
// 开始绘制
const startDrawing = e => {
	isDrawingRef.current = true;
	redoStackRef.current = []; // 清空重做栈

	// 创建新的路径元素
	const newPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
	newPath.setAttribute('fill', 'none');
	newPath.setAttribute('stroke', brushColor);
	newPath.setAttribute('stroke-width', brushSize.toString());

	// 获取起始点坐标
	const rect = svgRef.current.getBoundingClientRect();
	const x = e.clientX - rect.left;
	const y = e.clientY - rect.top;

	// 设置路径的起始点
	newPath.setAttribute('d', `M ${x} ${y}`);

	// 添加到绘图组
	drawingGroupRef.current.appendChild(newPath);
	currentPathRef.current = newPath;
};

// 绘制中
const draw = e => {
	if (!isDrawingRef.current || !currentPathRef.current || !svgRef.current) return;

	// 获取当前坐标
	const rect = svgRef.current.getBoundingClientRect();
	const x = e.clientX - rect.left;
	const y = e.clientY - rect.top;

	// 更新路径数据
	const currentPath = currentPathRef.current;
	const currentD = currentPath.getAttribute('d') || '';
	currentPath.setAttribute('d', `${currentD} L ${x} ${y}`);
};
```

### 3. 笔刷效果切换

```javascript
// 更新笔刷滤镜
const updateBrushFilter = () => {
	if (drawingGroupRef.current) {
		if (brushType === 'pen') {
			drawingGroupRef.current.style.filter = 'none';
		} else {
			drawingGroupRef.current.style.filter = `url(#${brushType}-filter)`;
		}
	}
};
```

## 总结

通过多层 SVG 滤镜和动态笔触算法的结合，我们实现了四种不同特色的笔刷效果。通过以下技术手段实现了逼真的水墨效果：

1. **多层滤镜组合**：使用 feTurbulence 生成不同频率的噪点，模拟水墨的纹理和晕染效果
2. **动态笔触宽度**：根据笔触的运动轨迹动态调整线条宽度，模拟真实毛笔的提按效果
3. **贝塞尔曲线优化**：使用二次贝塞尔曲线创建自然流畅的笔触
4. **纸张纹理背景**：添加真实的纸张纹理，增强整体视觉效果
