---
title: åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼ç®—æ³•
date: 2025-10-10 15:00:00
permalink: /notes/multi-header-table
categories:
  - ç¬”è®°
tags:
  - javascript
  - ç®—æ³•
  - è¡¨æ ¼
  - æ•°æ®å±•ç¤º
---

# åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼ç®—æ³•

åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼ç®—æ³•æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå…·æœ‰å¤æ‚è¡¨å¤´ç»“æ„çš„è¡¨æ ¼çš„æŠ€æœ¯ã€‚è¯¥ç®—æ³•å¯ä»¥æ ¹æ®é…ç½®åŠ¨æ€ç”Ÿæˆå…·æœ‰å¤šå±‚çº§è¡¨å¤´çš„è¡¨æ ¼ï¼Œé€‚ç”¨äºå„ç§æ•°æ®å±•ç¤ºåœºæ™¯ã€‚

## ğŸ¯ æ•ˆæœç‰¹ç‚¹

- **åŠ¨æ€ç”Ÿæˆ**: æ ¹æ®é…ç½®åŠ¨æ€ç”Ÿæˆå¤šå±‚çº§è¡¨å¤´
- **çµæ´»é…ç½®**: æ”¯æŒä»»æ„å±‚çº§çš„è¡¨å¤´åµŒå¥—
- **è‡ªåŠ¨è®¡ç®—**: è‡ªåŠ¨è®¡ç®—è¡Œåˆå¹¶å’Œåˆ—åˆå¹¶å±æ€§
- **æ•°æ®ç»‘å®š**: æ”¯æŒä¸è¡¨æ ¼æ•°æ®çš„è‡ªåŠ¨ç»‘å®š

## ğŸ”„ å·¥ä½œåŸç†

åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼ç®—æ³•çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
    A[é…ç½®è¡¨å¤´ç»“æ„] --> B[è®¡ç®—è¡¨å¤´å±‚çº§]
    B --> C[å¤„ç†è¡¨å¤´åˆå¹¶å±æ€§]
    C --> D[è®¡ç®—å¶å­èŠ‚ç‚¹]
    D --> E[ç”Ÿæˆè¡¨å¤´HTML]
    E --> F[ç”Ÿæˆè¡¨æ ¼å†…å®¹HTML]
    F --> G[ç»„åˆå®Œæ•´è¡¨æ ¼]
    G --> H[æ¸²æŸ“åˆ°é¡µé¢]
```

## ğŸ’» æ ¸å¿ƒå®ç°

### ç®—æ³•æ ¸å¿ƒä»£ç 

```javascript
/**
 * åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼
 * @param {Object} options - è¡¨æ ¼é…ç½®
 * @param {Array} options.headers - è¡¨å¤´é…ç½®æ•°ç»„
 * @param {Array} options.data - è¡¨æ ¼æ•°æ®æ•°ç»„
 * @param {string} options.containerId - å®¹å™¨ID
 */
function generateMultiHeaderTable(options) {
	const { headers, data, containerId } = options;
	const container = document.getElementById(containerId);
	if (!container) return;

	// 1. è®¡ç®—è¡¨å¤´å±‚çº§å’Œæ¯ä¸ªå•å…ƒæ ¼çš„åˆå¹¶å±æ€§
	const headerLevels = calculateHeaderLevels(headers);
	const processedHeaders = processHeaders(headers, headerLevels);

	// 2. ç”Ÿæˆè¡¨å¤´HTML
	const theadHtml = generateThead(processedHeaders, headerLevels);

	// 3. ç”Ÿæˆè¡¨æ ¼å†…å®¹HTML
	const tbodyHtml = generateTbody(data, processedHeaders);

	// 4. ç»„åˆæˆå®Œæ•´è¡¨æ ¼å¹¶æ¸²æŸ“
	const tableHtml = `
    <table border="1" cellpadding="8" cellspacing="0">
      ${theadHtml}
      ${tbodyHtml}
    </table>
  `;
	container.innerHTML = tableHtml;
}

/**
 * è®¡ç®—è¡¨å¤´çš„æœ€å¤§å±‚çº§
 */
function calculateHeaderLevels(headers) {
	let maxLevel = 1;

	function traverse(header, currentLevel) {
		if (currentLevel > maxLevel) {
			maxLevel = currentLevel;
		}
		if (header.children && header.children.length) {
			header.children.forEach(child => traverse(child, currentLevel + 1));
		}
	}

	headers.forEach(header => traverse(header, 1));
	return maxLevel;
}

/**
 * å¤„ç†è¡¨å¤´ï¼Œè®¡ç®—æ¯ä¸ªå•å…ƒæ ¼çš„rowspanå’Œcolspan
 */
function processHeaders(headers, totalLevels) {
	const result = [];

	function traverse(headers, currentLevel, parent) {
		headers.forEach(header => {
			// æ ‡è®°å½“å‰å±‚çº§
			header.level = currentLevel;

			// æ²¡æœ‰å­é¡¹çš„å•å…ƒæ ¼éœ€è¦è·¨è¶Šå¤šè¡Œ
			if (!header.children || !header.children.length) {
				header.rowspan = totalLevels - currentLevel + 1;
				header.colspan = 1;
				result.push(header);
			} else {
				// æœ‰å­é¡¹çš„å•å…ƒæ ¼åªå å½“å‰è¡Œ
				header.rowspan = 1;
				// è®¡ç®—éœ€è¦æ¨ªè·¨çš„åˆ—æ•°ï¼ˆå­é¡¹æ€»æ•°é‡ï¼‰
				header.colspan = countLeafNodes(header.children);
				result.push(header);

				// é€’å½’å¤„ç†å­é¡¹
				traverse(header.children, currentLevel + 1, header);
			}
		});
	}

	traverse(headers, 1, null);
	return result;
}

/**
 * è®¡ç®—å¶å­èŠ‚ç‚¹æ•°é‡ï¼ˆç”¨äºç¡®å®šcolspanï¼‰
 */
function countLeafNodes(headers) {
	let count = 0;

	function traverse(headers) {
		headers.forEach(header => {
			if (!header.children || !header.children.length) {
				count++;
			} else {
				traverse(header.children);
			}
		});
	}

	traverse(headers);
	return count;
}

/**
 * ç”Ÿæˆè¡¨å¤´HTML
 */
function generateThead(headers, totalLevels) {
	let thead = '<thead>';

	// ä¸ºæ¯ä¸ªå±‚çº§ç”Ÿæˆä¸€è¡Œ
	for (let level = 1; level <= totalLevels; level++) {
		const levelHeaders = headers.filter(header => header.level === level);
		thead += '<tr>';

		levelHeaders.forEach(header => {
			thead += `<th rowspan="${header.rowspan}" colspan="${header.colspan}">${header.name}</th>`;
		});

		thead += '</tr>';
	}

	thead += '</thead>';
	return thead;
}

/**
 * ç”Ÿæˆè¡¨æ ¼å†…å®¹HTML
 */
function generateTbody(data, headers) {
	// è·å–æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆæœ€ç»ˆåˆ—ï¼‰
	const leafHeaders = headers.filter(header => !header.children || !header.children.length);

	let tbody = '<tbody>';

	data.forEach(row => {
		tbody += '<tr>';

		leafHeaders.forEach(header => {
			tbody += `<td>${row[header.key] !== undefined ? row[header.key] : ''}</td>`;
		});

		tbody += '</tr>';
	});

	tbody += '</tbody>';
	return tbody;
}
```

### ä½¿ç”¨ç¤ºä¾‹

```javascript
// 1. å®šä¹‰è¡¨å¤´ç»“æ„
const headers = [
	{
		name: 'æ—¥æœŸ',
		key: 'date'
		// æ²¡æœ‰childrenè¡¨ç¤ºè¿™æ˜¯å¶å­èŠ‚ç‚¹
	},
	{
		name: 'äº§å“A',
		children: [
			{ name: 'é”€é‡', key: 'a_sales' },
			{ name: 'é”€å”®é¢', key: 'a_revenue' }
		]
	},
	{
		name: 'äº§å“B',
		children: [
			{ name: 'é”€é‡', key: 'b_sales' },
			{ name: 'é”€å”®é¢', key: 'b_revenue' },
			{
				name: 'å¢é•¿ç‡',
				children: [
					{ name: 'å‘¨ç¯æ¯”', key: 'b_week_growth' },
					{ name: 'æœˆç¯æ¯”', key: 'b_month_growth' }
				]
			}
		]
	},
	{
		name: 'æ€»è®¡',
		key: 'total'
	}
];

// 2. å®šä¹‰è¡¨æ ¼æ•°æ®
const tableData = [
	{
		date: '2023-01-01',
		a_sales: 120,
		a_revenue: 6000,
		b_sales: 80,
		b_revenue: 4000,
		b_week_growth: '12%',
		b_month_growth: '8%',
		total: 10000
	},
	{
		date: '2023-01-02',
		a_sales: 150,
		a_revenue: 7500,
		b_sales: 95,
		b_revenue: 4750,
		b_week_growth: '8%',
		b_month_growth: '5%',
		total: 12250
	}
];

// 3. ç”Ÿæˆè¡¨æ ¼
window.onload = () => {
	generateMultiHeaderTable({
		headers: headers,
		data: tableData,
		containerId: 'tableContainer'
	});
};
```

## âš›ï¸ React ç»„ä»¶å®ç°

<demo react="react/MultiHeaderTable/example.tsx" 
:reactFiles="['react/MultiHeaderTable/index.tsx','react/MultiHeaderTable/example.tsx']" 
/>

## âš™ï¸ å‚æ•°é…ç½®é€‰é¡¹

### è¡¨å¤´é…ç½® (headers)

| å±æ€§å   | ç±»å‹   | å¿…å¡« | è¯´æ˜                       |
| -------- | ------ | ---- | -------------------------- |
| name     | string | æ˜¯   | è¡¨å¤´æ˜¾ç¤ºåç§°               |
| key      | string | å¦   | æ•°æ®å­—æ®µåï¼ˆå¶å­èŠ‚ç‚¹å¿…å¡«ï¼‰ |
| children | array  | å¦   | å­è¡¨å¤´é…ç½®                 |

### æ•°æ®é…ç½® (data)

| å±æ€§å | ç±»å‹  | å¿…å¡« | è¯´æ˜         |
| ------ | ----- | ---- | ------------ |
| -      | array | æ˜¯   | è¡¨æ ¼æ•°æ®æ•°ç»„ |

### å®¹å™¨é…ç½® (containerId)

| å±æ€§å      | ç±»å‹   | å¿…å¡« | è¯´æ˜        |
| ----------- | ------ | ---- | ----------- |
| containerId | string | æ˜¯   | å®¹å™¨å…ƒç´  ID |

## ğŸ› ï¸ æŠ€æœ¯å¯¹æ¯”

| å®ç°æ–¹å¼        | ä¼˜ç‚¹               | ç¼ºç‚¹         | é€‚ç”¨åœºæ™¯     |
| --------------- | ------------------ | ------------ | ------------ |
| åŸç”Ÿ JavaScript | ç®€å•æ˜“æ‡‚ï¼Œå…¼å®¹æ€§å¥½ | åŠŸèƒ½ç›¸å¯¹ç®€å• | åŸºç¡€è¡¨æ ¼å±•ç¤º |
| React ç»„ä»¶      | ç»„ä»¶åŒ–ï¼Œæ˜“å¤ç”¨     | éœ€è¦æ¡†æ¶æ”¯æŒ | ç°ä»£å‰ç«¯é¡¹ç›® |
| ç¬¬ä¸‰æ–¹åº“        | åŠŸèƒ½å®Œå–„ï¼Œå¼€ç®±å³ç”¨ | å¢åŠ é¡¹ç›®ä½“ç§¯ | å¿«é€Ÿå¼€å‘éœ€æ±‚ |

## ğŸ¨ è®¾è®¡å»ºè®®

### ç”¨æˆ·ä½“éªŒ

- **å±‚çº§æ¸…æ™°**: åˆç†è®¾è®¡è¡¨å¤´å±‚çº§ï¼Œé¿å…è¿‡äºå¤æ‚
- **å¯¹é½å‡†ç¡®**: ç¡®ä¿è¡¨å¤´ä¸æ•°æ®åˆ—å‡†ç¡®å¯¹é½
- **å“åº”å¼**: è€ƒè™‘åœ¨å°å±å¹•ä¸Šçš„æ˜¾ç¤ºæ•ˆæœ

### è§†è§‰è®¾è®¡

- **è¾¹æ¡†æ ·å¼**: ä½¿ç”¨æ¸…æ™°çš„è¾¹æ¡†åŒºåˆ†è¡¨å¤´å’Œæ•°æ®
- **èƒŒæ™¯è‰²**: ä½¿ç”¨ä¸åŒçš„èƒŒæ™¯è‰²åŒºåˆ†è¡¨å¤´å±‚çº§
- **å­—ä½“å¤§å°**: åˆç†è®¾ç½®ä¸åŒå±‚çº§è¡¨å¤´çš„å­—ä½“å¤§å°

### æ€§èƒ½ä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**: å¯¹äºå¤§æ•°æ®é‡è¡¨æ ¼è€ƒè™‘è™šæ‹Ÿæ»šåŠ¨
- **ç¼“å­˜è®¡ç®—**: ç¼“å­˜è¡¨å¤´å±‚çº§å’Œåˆå¹¶å±æ€§è®¡ç®—ç»“æœ
- **æŒ‰éœ€æ¸²æŸ“**: åªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„è¡¨æ ¼å†…å®¹

## ğŸš€ è¿›é˜¶åº”ç”¨

### åŠ¨æ€è¡¨å¤´

- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹è¡¨å¤´ç»“æ„
- æä¾› API æ¥å£ç”¨äºæ·»åŠ /åˆ é™¤è¡¨å¤´

### æ•°æ®æ’åº

- æ”¯æŒæŒ‰åˆ—æ’åºåŠŸèƒ½
- æä¾›è‡ªå®šä¹‰æ’åºè§„åˆ™

## ğŸ”§ æ•…éšœæ’é™¤

å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼š

1. **è¡¨å¤´å¯¹é½é—®é¢˜**ï¼š

   - æ£€æŸ¥è¡¨å¤´é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ rowspan å’Œ colspan è®¡ç®—å‡†ç¡®

2. **æ•°æ®ç»‘å®šé”™è¯¯**ï¼š

   - ç¡®è®¤æ•°æ®å­—æ®µåä¸è¡¨å¤´ key åŒ¹é…
   - æ£€æŸ¥æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®

3. **æ¸²æŸ“å¼‚å¸¸**ï¼š
   - ç¡®ä¿å®¹å™¨å…ƒç´ å­˜åœ¨ä¸” ID æ­£ç¡®
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

---

_åŠ¨æ€ç”Ÿæˆå¤šå±‚è¡¨å¤´è¡¨æ ¼ç®—æ³•ä¸ºå¤æ‚æ•°æ®å±•ç¤ºæä¾›äº†çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§ä¸šåŠ¡åœºæ™¯ä¸‹çš„è¡¨æ ¼éœ€æ±‚ã€‚_
