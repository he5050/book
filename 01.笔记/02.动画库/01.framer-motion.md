---
date: 2025-06-04 23:13:15
title: framer-motion 动画库
permalink: /notes/动画库
categories:
  - 笔记
tags:
  - 动画库
  - framer-motion
---

# Framer Motion 动画库

Framer Motion 是一个为 React 设计的生产级动画库，提供了简洁的 API 和强大的动画功能。它让复杂的动画变得简单，同时保持了出色的性能。

## 核心特性

- **声明式 API**: 通过简单的 props 定义复杂动画
- **手势支持**: 内置拖拽、点击、悬停等手势识别
- **布局动画**: 自动处理布局变化的动画
- **SVG 支持**: 完整的 SVG 路径和形状动画
- **服务端渲染**: 支持 SSR 和静态生成
- **TypeScript**: 完整的类型支持

## 安装

```bash
npm install framer-motion
# 或
yarn add framer-motion
```

## 基础用法

### 基础动画示例

<demo react="react/Animate/FramerMotion/index.tsx" :reactFiles='["react/Animate/FramerMotion/index.tsx"]' />

**核心概念**：

- `motion.div`: 可动画的 HTML 元素
- `initial`: 初始状态
- `animate`: 目标状态
- `transition`: 动画过渡配置

### 高级动画效果

<demo react="react/Animate/FramerMotion/framer.tsx" :reactFiles='["react/Animate/FramerMotion/framer.tsx","react/Animate/FramerMotion/framer.scss"]' />

## 核心 API

### motion 组件

```jsx
import { motion } from 'framer-motion';

// 基础用法
<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }}>
	内容
</motion.div>;
```

### 动画属性

#### 变换属性 (Transform)

- `x`, `y`, `z`: 位移
- `scale`, `scaleX`, `scaleY`: 缩放
- `rotate`, `rotateX`, `rotateY`, `rotateZ`: 旋转
- `skew`, `skewX`, `skewY`: 倾斜

#### 样式属性 (Style)

- `opacity`: 透明度
- `backgroundColor`: 背景色
- `color`: 文字颜色
- `width`, `height`: 尺寸
- `borderRadius`: 圆角

#### SVG 属性

- `pathLength`: 路径长度
- `pathOffset`: 路径偏移
- `fill`, `stroke`: 填充和描边

### 手势事件

```jsx
<motion.div
	whileHover={{ scale: 1.1 }}
	whileTap={{ scale: 0.9 }}
	whileDrag={{ rotate: 90 }}
	drag
	dragConstraints={{ left: 0, right: 300, top: 0, bottom: 300 }}
>
	可交互元素
</motion.div>
```

### 变体 (Variants)

```jsx
const variants = {
  hidden: { opacity: 0, y: 50 },
  visible: {
    opacity: 1,
    y: 0,
    transition: { duration: 0.5 }
  }
}

<motion.div
  variants={variants}
  initial="hidden"
  animate="visible"
>
  内容
</motion.div>
```

## 高级功能

### 布局动画

```jsx
<motion.div layout>内容变化时自动动画</motion.div>
```

### 共享布局动画

```jsx
<motion.div layoutId="shared-element">在不同位置间平滑过渡</motion.div>
```

### 页面过渡

```jsx
import { AnimatePresence } from 'framer-motion';

<AnimatePresence>
	{isVisible && (
		<motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
			条件渲染的内容
		</motion.div>
	)}
</AnimatePresence>;
```

### 滚动触发动画

```jsx
import { useInView } from 'framer-motion'

const ref = useRef(null)
const isInView = useInView(ref)

<motion.div
  ref={ref}
  animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 100 }}
>
  滚动到视口时动画
</motion.div>
```

## 实用 Hooks

### useAnimation

```jsx
import { useAnimation } from 'framer-motion';

const controls = useAnimation();

const startAnimation = () => {
	controls.start({ x: 100, transition: { duration: 2 } });
};

<motion.div animate={controls} />;
```

### useMotionValue

```jsx
import { useMotionValue, useTransform } from 'framer-motion'

const x = useMotionValue(0)
const opacity = useTransform(x, [-100, 0, 100], [0, 1, 0])

<motion.div drag="x" style={{ x, opacity }} />
```

### useSpring

```jsx
import { useSpring } from 'framer-motion';

const x = useSpring(0, { stiffness: 300, damping: 30 });

// 更新值时会有弹性动画
x.set(100);
```

## 最佳实践

### 性能优化

1. **使用 transform 属性**: 优先使用 `x`, `y`, `scale`, `rotate` 等 transform 属性
2. **避免布局属性**: 尽量避免动画 `width`, `height`, `top`, `left` 等会触发重排的属性
3. **使用 will-change**: 对于复杂动画，添加 `will-change` 提示浏览器优化
4. **合理使用 layoutId**: 只在必要时使用共享布局动画

### 用户体验

1. **尊重用户偏好**: 检查 `prefers-reduced-motion` 设置
2. **合理的动画时长**: 通常 0.2-0.5 秒比较合适
3. **缓动函数**: 使用自然的缓动效果，如 `ease-out`
4. **提供反馈**: 交互时提供视觉反馈

### 代码组织

1. **抽取变体**: 将复杂的动画配置抽取为变体
2. **自定义 Hook**: 封装常用的动画逻辑
3. **组件化**: 创建可复用的动画组件
4. **类型安全**: 充分利用 TypeScript 类型

## 常见动画模式

### 淡入淡出

```jsx
const fadeIn = {
	initial: { opacity: 0 },
	animate: { opacity: 1 },
	exit: { opacity: 0 }
};
```

### 滑动进入

```jsx
const slideIn = {
	initial: { x: -100, opacity: 0 },
	animate: { x: 0, opacity: 1 },
	exit: { x: 100, opacity: 0 }
};
```

### 弹性缩放

```jsx
const scaleIn = {
	initial: { scale: 0 },
	animate: { scale: 1 },
	transition: { type: 'spring', stiffness: 300, damping: 20 }
};
```

### 列表动画

```jsx
const container = {
	hidden: { opacity: 1, scale: 0 },
	visible: {
		opacity: 1,
		scale: 1,
		transition: {
			delayChildren: 0.3,
			staggerChildren: 0.2
		}
	}
};

const item = {
	hidden: { y: 20, opacity: 0 },
	visible: { y: 0, opacity: 1 }
};
```

## 调试技巧

### 开发工具

1. **Framer Motion DevTools**: 浏览器扩展，可视化动画状态
2. **React DevTools**: 查看组件状态和 props
3. **Performance 面板**: 分析动画性能

### 常见问题

1. **动画不流畅**: 检查是否使用了会触发重排的属性
2. **内存泄漏**: 确保在组件卸载时清理动画
3. **SSR 问题**: 使用 `LazyMotion` 减少服务端包大小

## 学习资源

- **官方文档**: https://www.framer.com/motion/
- **示例集合**: https://www.framer.com/motion/examples/
- **社区资源**: GitHub、CodeSandbox 上的示例项目

---

_Framer Motion 让动画开发变得简单而强大，通过合理使用可以创造出令人印象深刻的用户体验。_
